(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-430fa8e6"],{"15aa":function(e,t,s){"use strict";s.r(t);var r=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"new-role-dialog"},[s("h1",{staticClass:"title"},[e._v(e._s(e.title))]),s("div",{staticClass:"content"},[s("el-form",{ref:"roleForm",staticClass:"roleForm",attrs:{model:e.roleForm,rules:e.rules,"label-width":"100px"}},[s("el-form-item",{attrs:{label:e.constants.FORM_ROLE_NAME,prop:"name"}},[s("el-input",{model:{value:e.roleForm.name,callback:function(t){e.$set(e.roleForm,"name","string"===typeof t?t.trim():t)},expression:"roleForm.name"}})],1),s("el-form-item",{staticClass:"permissions",attrs:{label:e.constants.ACCESS_CHOICE,prop:"permissions"}},e._l(e.permissions,(function(e,t){return s("access-group",{key:t,ref:"access"+t,refInFor:!0,attrs:{items:e.child,label:e.name}})})),1),s("el-form-item",{staticClass:"btn-group"},[s("el-button",{directives:[{name:"waves",rawName:"v-waves"}],on:{click:e.close}},[e._v(" "+e._s(e.constants.BTN_CANCLE)+" ")]),s("el-button",{directives:[{name:"waves",rawName:"v-waves"}],attrs:{type:"primary"},on:{click:function(t){return e.submitForm("roleForm")}}},[e._v(" "+e._s(e.constants.BTN_CONFIRM)+" ")])],1)],1)],1)])},i=[],a=(s("e260"),s("e6cf"),s("2532"),s("2ca0"),s("ddb0"),s("38fb")),n=s("fea5"),o={props:{visible:{type:Boolean,default:!0},permissions:{type:Array,default:()=>[]},actionType:{type:String,default:"add"},id:{type:[String,Number],default:""}},data(){var e=(e,t,s)=>{var r=this.getCheckedPermissions().length>0;r?s():s(new Error("至少选择一个权限"))};return{treeRole:[],roleForm:{name:"",permission:[]},rules:{name:[{required:!0,message:"请输入角色名称",trigger:"blur"},{max:20,message:"不能超过20个字符",trigger:"blur"}],permission:[{validator:e,trigger:"blur"}]},constants:{FORM_ROLE_NAME:a["m"],BTN_CANCLE:a["c"],BTN_CONFIRM:a["d"],ACCESS_CHOICE:a["a"]}}},methods:{close(){this.$emit("update:visible",!1)},submitForm(e){this.$refs[e].validate(e=>{if(!e)return!1;this.submitFunc(this.afterSubmit)})},getCheckedPermissions(){return Object.keys(this.$refs).filter(e=>e.startsWith("access")).map(e=>this.$refs[e]&&this.$refs[e][0]&&this.$refs[e][0].checkedList).reduce((e,t)=>e.concat(t),[])},addRole(e){Object(n["d"])(this.getParams()).then(t=>(this.$message({message:"添加成功",type:"success"}),e&&e()))},getParams(){return{name:this.roleForm.name,permissions:this.getCheckedPermissions()}},afterSubmit(){this.$emit("refresh"),this.close()},getInfo(e){Object(n["B"])(e).then(e=>{this.roleForm.name=e.name,this.setPermissions(e.permissions)})},updateRoleInfo(e){Object(n["eb"])(this.id,this.getParams()).then(t=>(this.$message({message:"修改成功",type:"success"}),e&&e()))},setPermissions(e){for(var t=Object.values(this.permissions.map(e=>{var t=e.child||[];return t.map(e=>e.id)})),s=0;s<t.length;s++){var r=[];for(var i of e)t[s].includes(i)&&r.push(i);this.$refs["access".concat(s)][0].checkedList=r}}},computed:{title(){return"add"==this.actionType?a["u"]:a["w"]},submitFunc(){return"add"==this.actionType?this.addRole:this.updateRoleInfo}},components:{"access-group":()=>s.e("chunk-766b811e").then(s.bind(null,"7dd4"))},created(){"modify"==this.actionType&&this.getInfo(this.id)}},c=o,l=(s("ea16"),s("2877")),m=Object(l["a"])(c,r,i,!1,null,"7cee6c88",null);t["default"]=m.exports},"2ca0":function(e,t,s){"use strict";var r=s("23e7"),i=s("06cf").f,a=s("50c4"),n=s("5a34"),o=s("1d80"),c=s("ab13"),l=s("c430"),m="".startsWith,u=Math.min,h=c("startsWith"),d=!l&&!h&&!!function(){var e=i(String.prototype,"startsWith");return e&&!e.writable}();r({target:"String",proto:!0,forced:!d&&!h},{startsWith:function(e){var t=String(o(this));n(e);var s=a(u(arguments.length>1?arguments[1]:void 0,t.length)),r=String(e);return m?m.call(t,r,s):t.slice(s,s+r.length)===r}})},b197:function(e,t,s){},ea16:function(e,t,s){"use strict";var r=s("b197"),i=s.n(r);i.a}}]);